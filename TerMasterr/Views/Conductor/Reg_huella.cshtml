
@{
    ViewBag.Title = "Reg_huella";
    Layout = "~/Views/Shared/_Layout - conductor.cshtml";
}

<h2>Reg_huella</h2>

<div class="container">
    <h2 class="mt-4 mb-4">Registro de Huella Dactilar</h2>
    <div class="card">
        <div class="card-body">
            <div id="fingerprint-icon" class="text-center mb-4">
                <svg width="100" height="100" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M12 1a10 10 0 0 1 10 10c0 5.52-4.48 10-10 10S2 16.52 2 11"></path>
                    <path d="M12 3a8 8 0 0 1 8 8c0 4.42-3.58 8-8 8s-8-3.58-8-8"></path>
                    <path d="M12 5a6 6 0 0 1 6 6c0 3.31-2.69 6-6 6s-6-2.69-6-6"></path>
                    <path d="M12 7a4 4 0 0 1 4 4c0 2.21-1.79 4-4 4s-4-1.79-4-4"></path>
                    <path d="M12 9a2 2 0 0 1 2 2c0 1.1-.9 2-2 2s-2-.9-2-2"></path>
                </svg>
            </div>
            <p id="status-message" class="text-center mb-4">Presione el botón para iniciar el registro de huella</p>
            <button id="start-scan" class="btn btn-primary btn-lg btn-block">Iniciar Registro de Huella</button>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(function () {
            var isScanning = false;
            var fingerprintIcon = $("#fingerprint-icon");
            var statusMessage = $("#status-message");
            var startScanButton = $("#start-scan");

            startScanButton.click(function () {
                if (!isScanning) {
                    isScanning = true;
                    fingerprintIcon.addClass("scanning");
                    statusMessage.text("Coloque su dedo en el sensor del teléfono...");
                    startScanButton.prop("disabled", true);

                    // Simulación de la lectura de la huella
                    setTimeout(function () {
                        // En una implementación real, aquí se obtendría la huella del dispositivo
                        var fingerprintData = new Uint8Array(32).fill(1); // Datos de huella simulados

                        $.ajax({
                            url: '@Url.Action("RegistrarHuella", "Conductor")',
                            type: 'POST',
                            contentType: 'application/json',
                            data: JSON.stringify({
                                id_conductor: @ViewBag.IdConductor,
                                huellaDactilar: Array.from(fingerprintData)
                            }),
                            success: function (response) {
                                if (response.success) {
                                    statusMessage.text(response.message);
                                    fingerprintIcon.removeClass("scanning").addClass("success");
                                } else {
                                    statusMessage.text("Error: " + response.message);
                                    fingerprintIcon.removeClass("scanning").addClass("failure");
                                }
                            },
                            error: function () {
                                statusMessage.text("Error al registrar la huella. Intente nuevamente.");
                                fingerprintIcon.removeClass("scanning").addClass("failure");
                            },
                            complete: function () {
                                isScanning = false;
                                startScanButton.prop("disabled", false);
                                setTimeout(function () {
                                    fingerprintIcon.removeClass("success failure");
                                }, 2000);
                            }
                        });
                    }, 3000);
                }
            });
        });
    </script>
    <style>
        #fingerprint-icon {
            transition: all 0.3s ease;
        }
        #fingerprint-icon.scanning {
            animation: pulse 1s infinite;
        }
        #fingerprint-icon.success {
            color: green;
        }
        #fingerprint-icon.failure {
            color: red;
        }
        @@keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
    </style>
}

